### 이미지 호스팅(on imgur) 하면서 겪은 우여곡절
 
#### 1. imgur 앱 등록 시 세 가지 옵션이 있었다. with callback api, without callback api, anynomous   
api docs에는 callback api 선택 시의 설명이 나와 있고 찾아보니 다른 사람들도 callback api를 사용한 경우가 대부분이었던 걸로 보였다. 그래서 나도 처음에는 그 옵션을 선택했다.   
    그리고 에러가 났고, 난 그 원인이 callback api 사용 시 유저 인증을 하지 않은 탓인가 생각했다. 하지만 다른 사람들도 나처럼 유저 인증을 하지 않은 상태에서 이미지 호스팅을 했더랬다. 그리고 api docs에는 포스트맨을 이용해 유저 인증을 하는 예시만 나와 있었고 그건 내가 바로 적용하기에 어려웠으며 결국에는 포스트맨 없이 이미지 호스팅을 해야 했기에 그 방법은 나에게 무용하다고 판단했다. 그래서 그건 패스하고 다시 방법을 찾아보았다. (그러면서 두 번째 옵션인 without callback api를 선택하고 다시 에러를 맞이했더랬다.. )   

#### 2. 해결방법을 계속 탐색해 보았다.
문서에는 이미지 호스팅을 유저 계정에 매이지 않고 anonymous로 할 수 있다고 했고, 다른 사람들의 코드에서도 anonymous 업로드의 endpoint가 사용되고 있었다. 그리고 앱 등록 시 anonymous 옵션을 선택해서 진행했다는 어떤 사람의 글을 보았고, 나도 그 옵션을 다시 선택했다. 내가 결국 원하는 건 간단한 이미지 호스팅이었지 토큰을 주고 받는 복잡한 유저 인증은 필요 없었기 때문이다. 그리고 endpoint도 anonymous upload 하는 걸로 계속 진행했다. (참고 : anonymous upload 하는 endpoint는 유저 인증을 하건 하지 않건 모두 사용 가능하다)    
  그리고 나는 에러를 얻었다.

#### 3. api 문서의 예시와 다른 사람들의 코드, 그리고 내 코드를 면밀히 비교해 본 결과 다른 사람들은 나와 달리 form data를 통해 이미지를 전달한다는 것을 알았고 그대로 적용했다.    
  (내가 처음에 그렇게 하지 않았던 이유는 내 요청 방식이 단순 js가 아니었기 때문이다. 나는 rtk 쿼리를 사용하고 있었고 api 쿼리를 rtk 방식에 맞게 새로 만들어야 했다. post 방식으로 요청하는 방식도 추가 설정이 필요했기에 이렇게 하기 까지 많은 탐색이 필요했다. 어쨌든 결국 호스팅 요청 쿼리를 만들었지만 그렇게 기존 요청 코드와 내 요청 코드가 많이 다르다 보니 form data에 담아 넘겨주는 부분도 꼭 같지 않아도 된다고 여겨 지나가 버린 듯 하다.)    
      이렇게 이미지를 넘겨주는 방식도 일치시켰으나 에러는 여전했다.    

   나는 429 에러를 받고 있었고, 그건 요청 리미트를 넘었을 때 받는 에러이다. api 문서를 자세히 보니 이미지 호스팅 시 넘겨주는 이미지 데이터 문자열의 길이가 내가 보내고 있는 것보다 훨씬 짧았다. 나는 이 부분이 원인이라고 생각했고 이미지 타입을 변형시켜 짧은 길이로 이미지를 보내고자 시도했다. 하지만 결국 이것도 원인이 아니었다.    

#### 4. 최종적으로 나는 localhost 문제로 돌아왔다.  
이미지 호스팅 시 localhost로는 불가능하고 배포 시 도메인을 넣었을 때 가능하다는 글이 있었다. 나는 이와 같은 글을 이전에 읽었었지만 일단 지나갔었다. 왜냐하면 로컬 환경에서 개발하고 있는 나에게 그건 당장 해결 불가능한 일이었기 때문이다. 그리고 그와 같은 문제가 일반적이었다면 api 문서는 물론이고 다수의 imgur 튜토리얼 글에도 그에 관한 내용이 적혀 있어야 할 텐데 그러지 않았기 때문이다. 그래서 나는 그건 imgur의 이전 버전 api에 남아있던 이슈일지도 모른다고 생각했다. 하지만 다른 시도가 막혔고 이제야 이 부분을 다루게 된 것이다.     

이 부분을 파면서 이전에 stackoverflow에서 검색했을 때 보다 약간 더 많은 글을 찾을 수 있었다. 그리고 다른 사람들이 localhost 문제를 해결하기 위해 했던 방식을 시도해 보았지만 그건 나에게는 적용되지 않았다. 혹은 dnscmd를 사용한다는 다소 복잡해 보이는 방식도 있었는데 지금 당장 적용하기는 어려웠다. 왜냐하면 내가 해당 분야에 대해 모르기 때문에 시간을 두고 그 부분을 배워야 했기 때문이다.    
그래도 일단 시도해 보다가 지쳐서 다른 방법을 탐색해 보았고, 도메인 이름만 바꾸면 되는 거라면 내 컴퓨터의 호스트를 바꾸기만 해도 되지 않을까 생각했다. 그래서 검색해 본 후 hosts 파일에서 도메인 이름을 바꾸었다. 파일 경로는 아래와 같다.        
    
   ```  C:\Windows\System32\drivers\etc\hosts   ```    
  이 때 그냥 수정하면 저장이 안 된다. 먼저 메모장을 관리자 모드로 실행한 후 위 파일을 열어야 한다. 그래야 저장이 됨.    

   ```  127.0.0.1       mydomain   ```   
       
위와 같이 한 줄을 hosts 파일에 추가해 주면 된다. ip 주소 옆에 내가 설정할 도메인 이름을 넣어 주면 됨.    
그리고 나서 진행중인 프로젝트로 돌아와 백과 프론트 모두 기존 코드에 설정했던 주소를 바꿔주고 (localhost -> 내 도메인)    
로그인 인증을 위한 도메인 변경을 위해 카카오 oauth 웹사이트로 가서 내 사이트 도메인과 redirect uri 모두 변경했다. (처음에는 카카오의 내 사이트 도메인만 변경했다가 카카오 로그인 에러가 났다. 왜 안 되는 거냐 탐색하다가 redirect uri 까지 변경...)     
그러고 나서 이미지 호스팅 성공! 이제 에러가 안 난다!!!! (야호!)    

     
호스팅 후 바로 이미지 링크를 받아올 수 있다. 내 경우엔 이렇게 했다.    
   ```result.data.data.link  이미지 링크```

  ```
  await ImageHosting(formData)
           .then((result) => {
             console.log("image result: ", result.data.data.link); // get image link from imgur
           })
   ```
       다음 작업에서는 이미지 링크를 저장해야지

#### (참고) imgur 에서는 이미지를 priviate으로 보관할 수가 없다. 이미지 링크만 알면 이미지를 열람할 수 있다는 것.
물론 이미지 링크는 아무나 알 수 있는 게 아니고 내가 호스팅을 하면 받아올 수 있는 것이다. 하지만 정확한 링크를 알면 누구나 열람할 수 있다. 이 부분은 유의해야 할 듯.    
아래는 관련 질문에 대한 답변을 발췌한 것    

```Posts uploaded without an account are anonymous and hidden. They cannot be searched and only those people with whom you share the URL will be able to see them. ```
 
이미지를 유저 계정으로 저장하거나 앨범에 넣더라도 이건 마찬가지. 이미지 자체에 링크가 부여되기 때문.

-22.05.15-
